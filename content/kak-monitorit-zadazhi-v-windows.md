+++
title = "Как мониторить задачи из планировщика Windows"
description = "Пошаговая настройка мониторинга для планировщика задач Windows."
date = 2020-06-23
updated = 2020-10-28

[taxonomies]
tags = ["scheduler", "windows"]
categories = ["tutorial", "windows", "monitoring", "cron"]
+++

Несмотря на то что наш проект называется [Cronbox](https://cronbox.ru) и 
первоначально он был создан для мониторинга cron-задач в Linux, вы можете пользоваться сервисом и для Windows-серверов.

Планировщик задач для Windows умеет делать всё то же, что и `cron`, и даже имеет дополнительные возможности. Например, поддерживает часовые
пояса.

#### 1. Создаём монитор и получаем ссылку

После [создания монитора](https://docs.cronbox.ru/getting-started/) формируется уникальная ссылка:

![Страница монитора](/images/windows-scheduler/monitor-page-url.png "Страница монитора")

Копируем её в блокнот, она ещё пригодится.

#### 2. Открываем планировщик задач

<details>
    <summary>Для Windows 10</summary>
    <p>
        Пуск > пишем "Планиро" и операционная система предложит нам Планировщик заданий.
        <img src="/images/windows-scheduler/open-windows-scheduler.png"
             title="Как запустить планировщик задач Windows"/>            
    </p>
</details>

<details>
    <summary>Для предыдущих версий Windows</summary>
    <p>
        Пуск > Выполнить > taskschd            
    </p>
</details>

Откроется приложение планировщика:

![Планировщик задач Windows](/images/windows-scheduler/windows-scheduler.png "Планировщик задач Windows")

Для примера интегрируем задачу резервного копирования с Cronbox.

#### 3. Создаём задачу

Настроим отправку HTTP-запроса к монитору после завершения выполнения задачи. 
Для отправки используем утилиту `curl` для Windows, её можно [скачать с официального сайта](https://curl.haxx.se/windows/).
Устанавливаем с параметрами по умолчанию.

Создадим новую задачу:

![Создание новой задачи в планировщике задач Windows](/images/windows-scheduler/create-task.png "Создание новой задачи в планировщике задач Windows")

Указываем название задачи. Например, резервное копирование документов:

![Указываем заголовок для задачи](/images/windows-scheduler/create-task-step1.png "Указываем заголовок для задачи")

Нажимаем "Далее >":

Выбираем когда будет стартовать задача. Например, ежедневно:

![Указываем когда будет стартовать задача](/images/windows-scheduler/create-task-step2.png "Указываем когда будет стартовать задача")

Указываем время для старта задачи. Например, 20:00.

![Указываем время для старта задачи](/images/windows-scheduler/create-task-step3.png "Указываем время для старта задачи")

Указываем действие - "Запустить программу":

![Выбираем действие 'Запустить программу'](/images/windows-scheduler/create-task-step4.png "Выбираем действие 'Запустить программу'")

Указываем команду, полная команда будет подобным образом:

```
c:\scripts\backup-docs.cmd && curl -fS --retry https://cronbox.ru/ping/39809ead-7e37-455f-ac95-adbf08d86140
```

![Выбираем действие 'Запустить программу'](/images/windows-scheduler/create-task-step5.png "Выбираем действие 'Запустить программу'")

Приложение покажет диалоговое окно, в котором нужно нажать "Нет" и тем самым сохранить нашу команду целиком:

![Отказываемся от изменений в команде](/images/windows-scheduler/create-task-step6.png "Отказываемся от изменений в команде")

![Завершающий шаг создания задачи](/images/windows-scheduler/create-task-step7.png "Завершающий шаг создания задачи")

Жмём "Готово". Задача будет сохранена и откроется вновь.

Необходимо указать чтобы задача запускалась для всех пользователей операционной системы, 
независимо от того какой пользователь активен в данный момент.

![Завершающий шаг создания задачи](/images/windows-scheduler/create-task-step8.png "Завершающий шаг создания задачи")

Отмечаем пункт "Выполнять для всех пользователей" и жмём "ОК".

### Итог

После создания задачи в планировщике Windows операционная система будет запускать ваш скрипт каждый день ровно в 20:00.
Если скрипт отработает успешно, будет запущен curl, который пошлёт отклик в Cronbox. Если скрипт не запустится или
выполнится с ошибкой, то уведомление через curl не будет отправлено в сервис. 
Cronbox отправит уведомление о том выполнилась задача по расписанию или нет.

## Другие статьи

1. [Как мониторить cron задачи в Linux](https://docs.cronbox.ru/how-to-ping/)

2. [Как настроить уведомления через E-mail и Telegram](https://docs.cronbox.ru/integrations/)
